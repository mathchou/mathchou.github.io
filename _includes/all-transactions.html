
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction List</title>
<style>
/* Style for the result container */
#resultContainer {
	position: relative; /* Positioning context for the button */
	width: 80%;  /* Make the result box half the screen width */
	height: 200px;  /* Fixed height */
	overflow: auto; /* Scrollable content */
	border: 1px solid #ccc;
	padding: 10px;
	margin-top: 10px;
	white-space: pre-wrap;  /* Ensures that long lines break properly */
	word-wrap: break-word;
	margin: 20px auto;  /* Center the box horizontally */
}

/* Make the text area within the box more readable */
/* Remove any default styling from pre */
#resultText {
    white-space: pre-wrap;  /* Keeps line breaks and spacing */
    word-wrap: break-word;  /* Wrap long words */
    background-color: transparent;  /* Make background transparent */
    color: black;  /* Ensure text color is readable */
    margin: 0;  /* Remove default margin */
    padding: 0;  /* Remove any padding */
    border: none;  /* Ensure there's no border */
}


#postsContainer div {
	margin-bottom: 5px;
	padding: 5px;
	border: 1px solid #ddd;
	border-radius: 2px;
	background-color: #f9f9f9;
	white-space: nowrap;       /* Prevent line breaks for long content */

	
.output-box {
    width: 80%;               /* Make it take the full width of its container */
    padding: 6px;             /* Add some space inside the box */
    border: 1px solid #ccc;   /* Light gray border */
    border-radius: 5px;       /* Rounded corners */
    font-family: 'Courier New', monospace; /* Monospaced font for the output */
    font-size: 13px;           /* Adjust text size */
    background-color: #fff;    /* White background */
    color: #333;               /* Dark text color */
    overflow-x: auto;          /* Allow horizontal scrolling if content overflows */
    margin-top: 5px;          /* Add some margin on top */
    white-space: pre-wrap;     /* Wrap text if it overflows */
}
	
}

</style>
</head>
<body>
    <h1>All transactions</h1>
	
	<div id="transactionsContainer"></div>
	<div id="paginationContainer" style="margin-top: 10px;"></div>

	<script>
	const herokuBackendUrl = 'https://choucoin-posts-4f7c7496eb49.herokuapp.com/';  // Replace with your actual Heroku app URL

	
	let allTransactions = [];
	let groupedTransactions = [];
	let currentPage = 0;

	async function fetchAndDisplayPaginatedTransactions() {
		try {
			const response = await fetch(`${herokuBackendUrl}get-transactions`);
			if (!response.ok) {
				throw new Error(`Error fetching transactions: ${response.status}`);
			}

			allTransactions = await response.json();

			// Sort transactions by date (newest first)
			allTransactions.sort((a, b) => new Date(b.datetime) - new Date(a.datetime));

			// Group transactions by week (starting Tuesday 12 AM)
			groupedTransactions = groupTransactionsByWeek(allTransactions);

			// Display the first page (most recent week)
			displayTransactions(currentPage);
		} catch (error) {
			console.error('Error fetching transactions:', error);
			document.getElementById('transactionsContainer').innerHTML = `<p>Error: ${error.message}</p>`;
		}
	}
	// Function to get the Tuesday 12 AM of a given date
	function getTuesdayMidnight(date) {
		const dayOfWeek = date.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
		const daysSinceTuesday = (dayOfWeek + 6) % 7; // Distance from Tuesday
		const tuesdayMidnight = new Date(date);
		tuesdayMidnight.setDate(date.getDate() - daysSinceTuesday);
		tuesdayMidnight.setHours(0, 0, 0, 0);
		return tuesdayMidnight;
	}

	// Function to group transactions by the week they belong to
	function groupTransactionsByWeek(transactions) {
		const weeks = new Map();

		transactions.forEach(tx => {
			const txDate = new Date(tx.datetime);
			if (isNaN(txDate)) {
				console.error("Invalid Date Found:", tx);
				return;
			}

			const weekStart = getTuesdayMidnight(txDate).getTime();
			if (!weeks.has(weekStart)) {
				weeks.set(weekStart, []);
			}
			weeks.get(weekStart).push(tx);
		});

		// Convert Map to sorted array (newest weeks first)
		return Array.from(weeks.entries())
			.sort((a, b) => b[0] - a[0])
			.map(entry => entry[1]);
	}

	// Function to display transactions of the current page
	function displayTransactions(page) {
		const transactionsContainer = document.getElementById('transactionsContainer');
		transactionsContainer.innerHTML = '';

		if (groupedTransactions.length === 0 || !groupedTransactions[page]) {
			transactionsContainer.innerHTML = '<p>No transactions found.</p>';
			return;
		}


		groupedTransactions[page].forEach(tx => {
			const p = document.createElement('p');
			p.textContent = `${tx.sender} sends ${tx.amount} Choucoin to ${tx.receiver} for ${tx.comment} on ${tx.datetime}`;
			transactionsContainer.appendChild(p);
		});

		displayPaginationControls();
	}

	// Function to create pagination controls
	function displayPaginationControls() {
		const paginationContainer = document.getElementById('paginationContainer');
		paginationContainer.innerHTML = '';


		if (groupedTransactions.length > 1) {
			if (currentPage > 0) {
				const prevButton = document.createElement('button');
				prevButton.textContent = 'Previous Week';
				prevButton.onclick = () => {
					currentPage--;
					displayTransactions(currentPage);
				};
				paginationContainer.appendChild(prevButton);
			}

			if (currentPage < groupedTransactions.length - 1) {
				const nextButton = document.createElement('button');
				nextButton.textContent = 'Next Week';
				nextButton.onclick = () => {
					currentPage++;
					displayTransactions(currentPage);
				};
				paginationContainer.appendChild(nextButton);
			}
		}
	}

	// Call function to fetch and display transactions after the DOM is loaded
	document.addEventListener('DOMContentLoaded', fetchAndDisplayPaginatedTransactions);
	</script>
	
</body>
</html>
